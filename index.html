<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Sistema de Bombeamento Solar</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="styles.css">
  <link rel="icon" href="icon.ico" type="image/x-icon">

  <!-- Leaflet (mapa) -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""
  />
</head>

<body>
<header>
  <h1>Sistema de Bombeamento com Energia Solar</h1>
  <p>Dimensionamento de demanda, AMT, vazão e recomendação de bomba.</p>
</header>

<main>
  <!-- =================== DEMANDA =================== -->
  <section class="card" id="sec-demanda">
    <h2>1. Demanda diária de água</h2>
    <p>Informe a quantidade de cada categoria. Os consumos médios são fixos (L/dia por unidade ou por área).</p>

    <table class="tabela-demanda">
      <thead>
      <tr>
        <th>Categoria</th>
        <th>Consumo</th>
        <th>Quantidade / Área</th>
      </tr>
      </thead>
      <tbody>
      <tr>
        <td>Pessoas</td>
        <td>84 L/dia</td>
        <td><input type="number" id="pessoasQtd" min="0" step="1" value="0"></td>
      </tr>
      <tr>
        <td>Bovinos</td>
        <td>45 L/dia</td>
        <td><input type="number" id="bovinosQtd" min="0" step="1" value="0"></td>
      </tr>
      <tr>
        <td>Suínos</td>
        <td>12,5 L/dia</td>
        <td><input type="number" id="suinosQtd" min="0" step="1" value="0"></td>
      </tr>

      <!-- >>> REFINADO POR ÁREA <<< -->
      <tr>
        <td>Horta (área)</td>
        <td>7 L/m²/dia</td>
        <td>
          <input type="number" id="hortaAreaM2" min="0" step="1" value="0">
        </td>
      </tr>
      <tr>
        <td>Pastagem (área)</td>
        <td>50.000 L/ha/dia</td>
        <td>
          <input type="number" id="pastagemAreaHa" min="0" step="0.01" value="0">
        </td>
      </tr>
      </tbody>
    </table>

    <div class="kpi-row">
      <div class="kpi">
        <span>Total diário</span>
        <strong><span id="totalLitrosDia">0</span> L/dia</strong>
      </div>
      <div class="kpi">
        <span>Total diário</span>
        <strong><span id="totalM3Dia">0</span> m³/dia</strong>
      </div>
    </div>
  </section>

  <!-- =================== HIDRÁULICA =================== -->
  <section class="card" id="sec-hidraulica">
    <h2>2. Hidrodinâmica (AMT)</h2>
    <div class="grid-3">
      <label>
        Profundidade do poço (m)
        <input type="number" id="pocoProfundidade" min="0" step="0.1" value="0">
      </label>
      <label>
        Altura do reservatório (m)
        <input type="number" id="reservatorioAltura" min="0" step="0.1" value="0">
      </label>
      <label>
        Distância da tubulação (m)
        <input type="number" id="distanciaTubulacao" min="0" step="1" value="0">
      </label>
    </div>

    <p class="info-menor">
      Distância em km: <strong><span id="distanciaKm">0</span> km</strong>
    </p>

    <div class="kpi-row">
      <div class="kpi">
        <span>Perdas de carga (10% da distância)</span>
        <strong><span id="perdasCarga">0</span> m</strong>
      </div>
      <div class="kpi">
        <span>Altura Manométrica Total (AMT)</span>
        <strong><span id="amtResultado">0</span> m</strong>
      </div>
    </div>

    <div id="avisos" class="avisos"></div>
  </section>

  <!-- =================== VAZÃO / POTÊNCIA =================== -->
  <section class="card" id="sec-vazao">
    <h2>3. Vazão mínima e potência</h2>

    <div class="grid-3">
      <label>
        Horas de bombeamento por dia
        <input type="number" id="horasBombeamento" min="0.5" step="0.1" value="5.5">
      </label>
      <label>
        Eficiência global (0 a 1)
        <input type="number" id="eficienciaBomba" min="0.1" max="1" step="0.05" value="0.6">
      </label>
      <label class="checkbox-inline">
        <input type="checkbox" id="habilitarPotencia" checked>
        Calcular potência
      </label>
    </div>

    <div class="kpi-row">
      <div class="kpi">
        <span>Vazão necessária</span>
        <strong><span id="vazaoLh">0</span> L/h</strong>
        <small><span id="vazaoLmin">0</span> L/min</small>
      </div>
      <div class="kpi">
        <span>Vazão em m³</span>
        <strong><span id="vazaoM3h">0</span> m³/h</strong>
        <small><span id="vazaoM3dia">0</span> m³/dia</small>
      </div>
      <div class="kpi">
        <span>Potência estimada</span>
        <strong><span id="potenciaEletrica">0</span> W</strong>
        <small>Potência hidráulica: <span id="potenciaHidraulica">0</span> W</small>
      </div>
    </div>
  </section>

  <!-- =================== MAPA =================== -->
  <section class="card" id="sec-mapa">
    <h2>4. Mapa (Leaflet / OSM)</h2>
    <p>Clique em dois pontos (captação e entrega). A distância será usada como comprimento da tubulação.</p>
    <div id="map"></div>
    <div class="map-actions">
      <button id="btnResetMapa">Resetar pontos</button>
      <span>Distância medida: <strong><span id="distanciaMapaInfo">0</span> m</strong></span>
    </div>
  </section>

  <!-- =================== CATÁLOGO E RECOMENDAÇÃO =================== -->
  <section class="card" id="sec-catalogo">
    <h2>5. Catálogo de bombas e recomendação</h2>

    <div class="grid-4">
      <label>
        Margem de vazão
        <input type="number" id="margemVazao" min="1" step="0.05" value="1.2">
        <small>Ex.: 1,2 = 20% de folga</small>
      </label>
      <label>
        Margem de AMT
        <input type="number" id="margemAMT" min="1" step="0.05" value="1.1">
      </label>
      <label>
        Filtro por tipo
        <select id="filtroTipo">
          <option value="">Todos</option>
          <option value="Solar DC">Solar DC</option>
          <option value="AC">AC</option>
        </select>
      </label>
      <label>
        Filtro por tensão (ex.: 24V, 48V, 220V)
        <input type="text" id="filtroTensao" placeholder="ex.: 24V">
      </label>
    </div>

    <h3>Catálogo (JSON)</h3>
    <div class="catalogo-actions">
      <input type="file" id="fileCatalogo" accept="application/json">
      <button id="btnImportCatalogo">Importar JSON</button>
      <button id="btnExportCatalogo">Exportar JSON</button>
      <button id="btnAplicarCatalogo">Aplicar texto do catálogo</button>
    </div>
    <textarea id="catalogoJson" rows="8"></textarea>

    <h3>Recomendação</h3>
    <p>Bomba recomendada: <strong id="bombaRecomendada">—</strong></p>

    <div class="table-wrapper">
      <table>
        <thead>
        <tr>
          <th>#</th>
          <th>Nome</th>
          <th>Tipo</th>
          <th>Tensão</th>
          <th>Potência (W)</th>
          <th>Qmax (L/h)</th>
          <th>Hmax (m)</th>
          <th>Status</th>
        </tr>
        </thead>
        <tbody id="tabelaBombas">
        <!-- Preenchido via JS -->
        </tbody>
      </table>
    </div>
  </section>

  <!-- =================== RESUMO E CONTROLES GERAIS =================== -->
  <section class="card" id="sec-resumo">
    <h2>6. Resumo do Projeto</h2>

    <div class="resumo-actions">
      <button id="btnSalvarProjeto">Salvar projeto</button>
      <button id="btnCarregarProjeto">Carregar projeto</button>
      <button id="btnGerarPdf">Gerar Relatório (PDF)</button>
      <button id="btnCopiarResumo">Copiar resumo</button>
    </div>

    <pre id="resumoTexto" class="resumo-texto"></pre>
  </section>
</main>

<footer>
  <small>Projeto acadêmico - Bombeamento com energia solar.</small>
</footer>

<!-- Scripts -->
<script
  src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
  integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
  crossorigin=""
></script>

<!-- jsPDF (sem integrity para evitar bloqueio por hash divergente no CDN) -->
<script
  src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"
  crossorigin="anonymous"
  referrerpolicy="no-referrer"
></script>

<script src="app.js"></script>
</body>
</html>
